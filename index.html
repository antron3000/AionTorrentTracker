<html>
<body>

  <!-- aion web3 avm file -->
<script type="text/javascript" src="./js/web3.min.js"></script>
 <script>
 let web3 = new Web3(new Web3.providers.HttpProvider("http://35.245.69.208:8545"));
// let web3 = new Web3(new Web3.providers.HttpProvider("https://api.nodesmith.io/v1/aion/avmtestnet/jsonrpc?apiKey=ENTERAPIKEY"));






 </script>



<iframe style="display:none" name="magnetframe"></iframe>


<h3>
  Upload Torrent
</h3>

<form id='input-form'>
	<input type="text" id='display-name' placeholder="Please Enter the Link Name" required />
	<input type="email" id='magnet-link' placeholder="Please Enter ythe Magnet Link" required />
	<input type="submit" id='torrent-upload-button' onclick="upload()" />
</form>


<br>
<label id="uploadSuccess"> </label>


<hr>

  <h3>
    Download Torrent
  </h3>
  <input type="number" id="torrent-index"> Torrent Index</input> <button id="downloadButton" onclick="download()">download</button>

  <label id="downloadSuccess"> </label>

</body>

<script>
function test(){
  console.log(aionweb3)
}

function upload(){

// or
let aiwa = aionweb3;

// 1. Define Method & Encode
var upload = web3.avm.method("upload").argTypes("String","String")


var displayName = document.forms['input-form'].elements['display-name'].value;
var magLink = document.forms['input-form'].elements['magnet-link'].value;


let data = upload.encodeToHex(displayName, magLink);

let amount = 0;
// 2. Create TX object
txObject = {
  from: "0xa075345d0ec568d8b9edc7bb9fa1cb7c46be78f0bc2a063d332acb2f6a79132a",
  to: "0x0F70ebAAaefc8D47804eFad73B21b7a1E9Ca01E902b3D51C6C66d51C98FBf2C2",
  data: data,
  gas: 2000000,
  type: '0xf',
  value: web3.utils.toNAmp(amount.toString())
}

// 3. Prompt AIWA
aiwa.eth.sendTransaction( // I assigned aiwa = aionweb3 previously
  txObject
).then(function(txHash){
  console.log('txHash:', txHash);
});

}

let myContract;
let contractAddress;
function contractSetup(){
  contractAddress = "0x0F70ebAAaefc8D47804eFad73B21b7a1E9Ca01E902b3D51C6C66d51C98FBf2C2";
  myContract = new web3.eth.Contract(casinoJSON.info.abiDefinition, contractAddress);
}

function download(){
  // or
  let aiwa = aionweb3;

  // 1. Define Method & Encode
  var getValue = web3.avm.method("getMagnetLink").argTypes("int")
  //let _data = getValue.encodeToHex(0);

  let _data = getValue.encodeToHex(document.getElementById("torrent-index").value)
  console.log(_data)

  var result = web3.eth.call({
      to: "0x0F70ebAAaefc8D47804eFad73B21b7a1E9Ca01E902b3D51C6C66d51C98FBf2C2", // contract address
      data: _data
  });

  result.then(function(value){
    value = web3.avm.decodeOneObjectFromHex(value);

    console.log(value);

    window.open(value, 'magnetframe')
  })



  }

</script>
</html>
